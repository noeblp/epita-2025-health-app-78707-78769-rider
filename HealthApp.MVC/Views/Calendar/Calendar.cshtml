@{
    ViewData["Title"] = "Calendrier Dynamique";
    int year = ViewBag.CurrentYear;
    int month = ViewBag.CurrentMonth;
    int week = ViewBag.CurrentWeek;
    var events = ViewBag.Events as List<hospital.Models.Calendar>;
    var startOfWeek = ViewBag.StartOfWeek as DateTime? ?? DateTime.Now;
}
<li class="button">
    <a class="btn btn-primary text-white fw-bold px-4 py-2"
       asp-area="" asp-controller="Doctor" asp-action="HomeDoctor">
        Home
    </a>
</li>
<h2 style="text-align: center; font-size: 1.5rem;">Week of @startOfWeek.ToString("dd MMMM yyyy")</h2>

<div style="display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; height: 100vh;">
    <table style="width: 100%; max-width: 1000px; border-collapse: collapse; height: 80%; overflow: auto; table-layout: fixed;">
        <thead>
        <tr style="background-color: #f0f0f0; height: 5%">
            <th style="border: 1px solid black; text-align: center; padding: 10px; width: 10%;"></th>
            <th style="border: 1px solid black; text-align: center; padding: 10px; width: 12.85%;">Monday </th>
            <th style="border: 1px solid black; text-align: center; padding: 10px; width: 12.85%;">Tuesday</th>
            <th style="border: 1px solid black; text-align: center; padding: 10px; width: 12.85%;">Wednesday</th>
            <th style="border: 1px solid black; text-align: center; padding: 10px; width: 12.85%;">Thursday</th>
            <th style="border: 1px solid black; text-align: center; padding: 10px; width: 12.85%;">Friday</th>
            <th style="border: 1px solid black; text-align: center; padding: 10px; width: 12.85%;">Saturday</th>
            <th style="border: 1px solid black; text-align: center; padding: 10px; width: 12.85%;">Sunday</th>
        </tr>
        </thead>
        <tbody>
        @for (int hour = 8; hour <= 18; hour++)
        {
            <tr>
                <td style="border: 1px solid black; text-align: center; font-weight: bold; width: 10%;">@hour:00</td>
                @for (int i = 0; i < 7; i++)
                {
                    var currentDate = startOfWeek.AddDays(i);
                    var eventToday = events?.Where(e => e.Date.Date == currentDate.Date && e.Date.Hour == hour).ToList();
                    <td style="border: 1px solid black; text-align: center; vertical-align: top; font-size: 1rem; width: 12.85%; min-height: 50px; overflow: hidden;">
                        @if (eventToday != null && eventToday.Any())
                        {
                            @foreach (var evt in eventToday)
                            {
                                <div style="color: red; font-weight: bold; word-wrap: break-word; margin-top: 5px;">@evt.Title</div>
                            }
                        }
                    </td>
                }
            </tr>
        }
        </tbody>
    </table>
</div>

<div style="position: absolute; left: 10px; top: 80%; transform: translateY(-50%); border: 2px solid #000; padding: 10px;">
    <a href="@Url.Action("Calendar", new { year = year, month = month, week = week - 1 })" style="text-decoration: none; color: #000; font-size: 1rem;">← Previous week </a>
</div>

<div style="position: absolute; right: 10px; top: 80%; transform: translateY(-50%); border: 2px solid #000; padding: 10px;">
    <a href="@Url.Action("Calendar", new { year = year, month = month, week = week + 1 })" style="text-decoration: none; color: #000; font-size: 1rem;">Next week →</a>
</div>